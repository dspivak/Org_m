\chapter{Background} \label{sec:background}

For background on $\poly$ see \cite{niu2022poly}. In \cref{sec.(co)free(co)monad} we briefly recall the free monad $\free_-$ and cofree comonad $\cofree_-$ constructions, as well as the module structure $\free_p\otimes\cofree_q\to\free_{p\otimes q}$ between them. In \cref{sec.orgsharp} we discuss the $\smcat^\sharp$-enriched category $\org^\sharp$ to which we will extend the free monad and cofree comonad constructions.


\section{The free monad monad and the cofree comonad comonad}\label{sec.(co)free(co)monad}

Two key players in our story are the free monad monad $\free$ and the cofree comonad comonad $\cofree$. The general construction of the free monad monad was introduced in \cite{kelly1980unified} and an intuitive explanation was given in \cite{libkind2024pattern}; we describe their key features below. A \defined{polynomial monad} (referred to here as monad) is a $\tri$-monoid. The category of polynomial monads is $\modpoly$. A \defined{ polynomial comonad} (referred to here as comonad) is a $\tri$-comonoid. There is an equivalence
\[
    \Cat{Comod}_\poly\cong\smcat^\sharp
\]
between the category of polynomial comonads and the category $\smcat^\sharp$ consisting of categories and retrofunctors between them.

Given a polynomial $p$, the free monad is the polynomial $\free_p$ whose positions are $p$-shaped decision trees and whose directions are the leaves of the tree. For example, the following is a position of $\free_{\yon^2}$ with $5$ directions. 

\input{figures/mp-example}

The free monad is defined via transfinite induction where we define polynomials $p\hoc{\alpha}$ for ordinals $\alpha$ and cartesian inclusions $\iota\hoc\alpha\colon p\hoc{\alpha} \to p\hoc{\alpha +1}$. For the base case, $p\hoc{0} \coloneqq \yon$. For successor ordinals $\alpha + 1$, $p\hoc{\alpha + 1} \coloneqq \yon + p \tri p\hoc{\alpha}$, and for limit ordinals $\alpha$, $p\hoc{\alpha} \coloneqq \colim_{\alpha' < \alpha} p \hoc{\alpha'}$. 


\cite[Theorem 2.10]{libkind2024pattern} defines an adjunction
\[
    \adj{\poly}{\free_-}{U}{\modpoly}
\]
whose unit we denote $\mun$ and whose counit we denote $\mcoun$.

Given a polynomial $p$, the cofree comonad is $\cofree_p$ whose positions are $p$-shaped behavior trees and whose directions are finite paths up the tree. For example, a position of $\cofree_{2y}$ is a stream of $0$s and $1$ (the two positions of $2y$). Its directions are the natural numbers, where a direction $n$ corresponds to the first $n$ tokens of the stream.

\cite[Theorem 3.2]{libkind2024pattern} defines an adjunction 
\[
    \adj{\catsharp}{U}{\cofree_-}{\poly}
\]
whose counit we denote $\ccoun$. The functor $\cofree$ is lax monoidal with respect to $\otimes$, so it has a productor and unitor of the following types:
\[
\cofree_p\otimes\cofree_q\to\cofree_{p\otimes q}\qqand\yon\to\cofree_\yon.
\]

The main result of \cite[Theorem 3.4]{libkind2024pattern} was to prove that $\free_-$ is a left module over $U \circ  \cofree \colon \poly \to \poly$ whose action is defined by the natural transformation 
\[
    \modstruct_{p,q}\colon \free_p \otimes \cofree_q \to \free_{p \otimes q}
\] which is defined as the image of the composite
\[
    p \otimes \cofree_q \xrightarrow{p \otimes \ccoun_q} p \otimes q \xrightarrow{\mun_{p \otimes q}} \free_{p \otimes q}
\] under the isomorphisms
\[
    \poly(p \otimes \cofree_q, \free_{p\otimes q})  \iso \modpoly(\free_p, [\cofree_q, \free_{p\otimes q}]) \to \poly(\free_p \otimes \cofree_q, \free_{p \otimes q}).
\] We call $\modstruct$ the \defined{interaction law}.



\section{The $\smcat^\sharp$-enriched category $\org^\sharp$}\label{sec.orgsharp}

In this paper we define $\org^\sharp$ to be the $\smcat^\sharp$-enriched category whose objects are polynomials and whose morphisms are defined by $\org^\sharp(p, q) \coloneqq \cofree_{[p,q]}$. 
Composition is defined by 
\[
    \cofree_{[p,q]} \otimes \cofree_{[q,r]} \to \cofree_{[p, q] \otimes [q, r]} \to \cofree_{[p, r]}
\]
where the first map is the productor of $\cofree$ and the second uses functoriality of $\cofree$ and internal-hom composition.

For the identity on a polynomial $p$, we use the fact that $\yon$ has a unique comonoid structure, and take the image of the polynomial identity on $p$ under the isomorphisms
\[
    \poly(p, p) \iso \poly(\yon , [p, p]) \iso \smcat^\#(\yon, \cofree_{[p,p]}).
\]

Consider the lax monoidal functor
\[\Cat{CAT}(-,\smset) \colon \smcat^\sharp \to \smcat\]\dnote{I know I suggested the above notation, but I now think we should use different notation, here and below. Retrofunctors $\cat{C}\coto\cat{D}$ can be factored as vertical (bijective on objects) followed by cartesian (discrete opfibration). So $\Cat{CAT}(-,\smset)$ is really the functor that assigns to each $\cat{D}$ the category of Cartesian retrofunctors $\cat{C}\to\cat{D}$ over it and given $F\colon\cat{D}\to\cat{D}'$, factor the composite $\cat{C}\to\cat{D}'$ and use the second factor. Since cartesian retrofunctors are exactly the same as discrete opfibrations, and since these are equivalent to copresheaves, we denote this by XYZ.}
which sends the category $\cat{C}$ to the category $\cat{C}$-sets, i.e.\ functors $\cat{C}\to\smset$. This gives a change of enrichment, which sends $\org^\sharp$ to the monoidal 2-category whose objects are polynomials under $\otimes$ and for which $\hom(p,q)=\cofree_{[p,q]}-\smset$. This is equivalent to the category-enriched operad $\org$ defined in \cite[Definition 2.19]{spivak2021learnersv1}.

\begin{remark}
    What is the relationship between $\poly$ and $\org^\sharp$? Since $(\poly, \otimes, \yon)$ has internal homs, $\poly$ can be viewed as a $(\poly, \otimes, \yon)$-enriched category. Via the lax monoidal functor of enrichment categories $\cofree\colon (\poly, \otimes, \yon) \to (\smcat^\sharp, \otimes, \yon)$, we obtain the $\smcat^\sharp$-enriched category $\org^\sharp$.
\end{remark}

