\chapter{The behavior of delegation}\label{sec:orgc}

The operad $\org_\free$ defines patterns of dynamic delegation. This interpretation begs the question of how delegation patterns translate into behaviors of taskmasters and their subordinates. In other words, how do each of the examples in \cref{ex:stream-m} turn the behaviors of Alice, Bob, and Carmen into a behavior of their taskmaster? We begin to answer this question by defining an operad $\org^\cofree$ that gives the semantics for the relationship between behaviors of subordinates and behaviors of their taskmaster.


\section{$\cofree$ is a comonad on $\org^\sharp$}

We will define a $\smcat^\sharp$-enriched functor $\cofree \colon \org^\sharp \to \org^\sharp$ and show that it is a comonad.

On objects $\cofree$ takes a polynomial $p$ to the cofree comonad $\cofree_p$. On morphisms $\cofree \colon \cofree_{[p,q]} \to \cofree_{[\cofree_p, \cofree_q]}$ is the image of the composite
\[
    \cofree_p \otimes \cofree_{[p,q]} \xrightarrow{\lax} \cofree_{p \otimes [p,q]} \xrightarrow{\cofree_\eval} \cofree_q
\] under the composite
\[
    \smcat^\sharp(\cofree_p \otimes \cofree_{[p,q]}, \cofree_q) \to  \poly(\cofree_p \otimes \cofree_{[p,q]}, \cofree_q) \iso \poly(\cofree_{[p,q]}, [\cofree_p, \cofree_q]) \iso \smcat^\sharp(\cofree_{[p,q]}, \cofree_{[\cofree_p, \cofree_q]}).
\]
This map $\cofree \colon \org^\# \to \org^\#$ preserves identity and composition for the same reasons that $\free \colon \org^\# \to \org^\#$ does. 

\begin{theorem}
    The $\smcat^\sharp$-enriched functor $\cofree \colon \org^\sharp \to \org^\sharp$ is a comonad.
\end{theorem}
\begin{proof}
    We need to define $\smcat^\sharp$-enriched natural transformations $\cofree \Rightarrow \id_\poly$ and $\cofree \Rightarrow \cofree \circ \cofree$ for the co-unit and comultiplication maps.

    For the polynomial $p$, the counit at $p$ is an element of $\smcat^\sharp(\yon, \cofree_{[\cofree_p, p]})$. We define it to be the image of the counit $\ccoun_p \colon \cofree_p \to p$ under the isomorphisms
    \[
        \poly(\cofree_p, p) \iso \poly(\yon, [\cofree_p, p]) \iso \smcat^\sharp(\yon, \cofree_{[\cofree_p, p]}).
    \]


    To show that the counit is natural we must show that the following diagram commutes.

  % https://q.uiver.app/#q=WzAsNixbMCwwLCJcXGNvZnJlZV97W3AscV19Il0sWzEsMF0sWzIsMCwiXFxjb2ZyZWVfe1tcXGNvZnJlZV9wLCBwXX0gXFxvdGltZXMgXFxjb2ZyZWVfe1twLHFdfSJdLFswLDEsIlxcY29mcmVlX3tbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfcV19Il0sWzEsMSwiXFxjb2ZyZWVfe1tcXGNvZnJlZV9wLCBcXGNvZnJlZV9xXX0gXFxvdGltZXMgXFxjb2ZyZWVfe1tcXGNvZnJlZV9xLCBxXX0iXSxbMiwxLCJcXGNvZnJlZV97W1xcY29mcmVlX3AsIHFdfSJdLFswLDNdLFswLDJdLFsyLDVdLFs0LDVdLFszLDRdXQ==
  \[\begin{tikzcd}
    {\cofree_{[p,q]}} & {} & {\cofree_{[\cofree_p, p]} \otimes \cofree_{[p,q]}} \\
    {\cofree_{[\cofree_p, \cofree_q]}} & {\cofree_{[\cofree_p, \cofree_q]} \otimes \cofree_{[\cofree_q, q]}} & {\cofree_{[\cofree_p, q]}}
    \arrow[from=1-1, to=1-3]
    \arrow[from=1-1, to=2-1]
    \arrow[from=1-3, to=2-3]
    \arrow[from=2-1, to=2-2]
    \arrow[from=2-2, to=2-3]
  \end{tikzcd}\]

  It suffices to show that the following diagram commutes.
    
    % https://q.uiver.app/#q=WzAsNixbMCwwLCJcXGNvZnJlZV9wIFxcb3RpbWVzIFxcY29mcmVlX3tbcCxxXX0iXSxbMSwwLCJcXGNvZnJlZV97cCBcXG90aW1lcyBbcCxxXX0iXSxbMiwwLCJcXGNvZnJlZV9xIl0sWzIsMSwicSJdLFsxLDEsInAgXFxvdGltZXMgW3AscV0iXSxbMCwxLCJwXFxvdGltZXMgW3AscV0iXSxbNSw0XSxbMCw1LCJcXGNjb3VuX3AgXFxvdGltZXMgXFxjY291bl97W3AscV19IiwyXSxbMCwxXSxbMSw0LCJcXGNjb3VuX3twIFxcb3RpbWVzIFtwLHFdfSJdLFsxLDJdLFsyLDMsIlxcY2NvdW5fcSJdLFs0LDNdXQ==
    \[\begin{tikzcd}[column sep=huge]
    	{\cofree_p \otimes \cofree_{[p,q]}} & {\cofree_{p \otimes [p,q]}} & {\cofree_q} \\
    	{p\otimes [p,q]} & {p \otimes [p,q]} & q
    	\arrow[from=1-1, to=1-2]
    	\arrow["{\ccoun_p \otimes \ccoun_{[p,q]}}"', from=1-1, to=2-1]
    	\arrow[from=1-2, to=1-3]
    	\arrow["{\ccoun_{p \otimes [p,q]}}", from=1-2, to=2-2]
    	\arrow["{\ccoun_q}", from=1-3, to=2-3]
    	\arrow[from=2-1, to=2-2]
    	\arrow[from=2-2, to=2-3]
    \end{tikzcd}\]

  The left-hand square commutes by definition of the compositor. The right-hand square commutes by naturality of the counit.

    For a polynomial $p$, define the comultiplication at $p$ to be the image of the unit $\cun_{\cofree_p} \colon \cofree_p \to \cofree_{\cofree_p}$ under the isomorphisms
    \[
        \poly(\cofree_p, \cofree_{\cofree_p}) \iso \poly(\yon, [\cofree_p, \cofree_{\cofree_p}]) \iso \cofree(\yon, \cofree_{[\cofree_p, \cofree_{\cofree_p}]}).
    \]
    To show that comultiplication is natural we must show that the following diagram commutes. 

    % https://q.uiver.app/#q=WzAsOCxbMCwwLCJcXGNvZnJlZV97W3AscV19Il0sWzEsMCwiXFxjb2ZyZWVfe1tcXGNvZnJlZV9wLCBcXGNvZnJlZV9xXX0iXSxbMiwwLCJcXGNvZnJlZV97W1xcY29mcmVlX3tcXGNvZnJlZV9wfSwgXFxjb2ZyZWVfe1xcY29mcmVlX3F9XX0iXSxbMywwLCJcXGNvZnJlZV97W1xcY29mcmVlX3AsIFxcY29mcmVlX3tcXGNvZnJlZV9wfV19IFxcb3RpbWVzIFxcY29mcmVlX3tbXFxjb2ZyZWVfe1xcY29mcmVlX3B9LCBcXGNvZnJlZV97XFxjb2ZyZWVfcX1dfSJdLFswLDEsIlxcY29mcmVlX3tbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfcV19Il0sWzIsMSwiXFxjb2ZyZWVfe1tcXGNvZnJlZV9wLCBcXGNvZnJlZV9xXX0gXFxvdGltZXMgXFxjb2ZyZWVfe1tcXGNvZnJlZV9xLCBcXGNvZnJlZV97XFxjb2ZyZWVfcX1dfSJdLFsxLDFdLFszLDEsIlxcY29mcmVlX3tbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfe1xcY29mcmVlX3F9XX0iXSxbMCw0XSxbNCw1XSxbMCwxXSxbMSwyXSxbMiwzXSxbNSw3XSxbMyw3XV0=
  \[\begin{tikzcd}
    {\cofree_{[p,q]}} & {\cofree_{[\cofree_p, \cofree_q]}} & {\cofree_{[\cofree_{\cofree_p}, \cofree_{\cofree_q}]}} & {\cofree_{[\cofree_p, \cofree_{\cofree_p}]} \otimes \cofree_{[\cofree_{\cofree_p}, \cofree_{\cofree_q}]}} \\
    {\cofree_{[\cofree_p, \cofree_q]}} & {} & {\cofree_{[\cofree_p, \cofree_q]} \otimes \cofree_{[\cofree_q, \cofree_{\cofree_q}]}} & {\cofree_{[\cofree_p, \cofree_{\cofree_q}]}}
    \arrow[from=1-1, to=1-2]
    \arrow[from=1-1, to=2-1]
    \arrow[from=1-2, to=1-3]
    \arrow[from=1-3, to=1-4]
    \arrow[from=1-4, to=2-4]
    \arrow[from=2-1, to=2-3]
    \arrow[from=2-3, to=2-4]
  \end{tikzcd}\]

  It suffices to show that the following diagram commutes. 

  % https://q.uiver.app/#q=WzAsNixbMCwwLCJcXGNvZnJlZV9wIFxcb3RpbWVzIFxcY29mcmVlX3tbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfcV19Il0sWzEsMCwiXFxjb2ZyZWVfe1xcY29mcmVlX3B9XFxvdGltZXMgXFxjb2ZyZWVfe1tcXGNvZnJlZV9wLCBcXGNvZnJlZV9xXX0iXSxbMiwwLCJcXGNvZnJlZV97XFxjb2ZyZWVfcCBcXG90aW1lcyBbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfcV19ICJdLFszLDAsIlxcY29mcmVlX3tcXGNvZnJlZV9xfSJdLFszLDEsIlxcY29mcmVlX3EiXSxbMiwxLCJcXGNvZnJlZV9wIFxcb3RpbWVzIFtcXGNvZnJlZV9wLCBcXGNvZnJlZV9xXSJdLFs1LDQsIlxcZXZhbCIsMl0sWzIsNSwiXFxjY291bl97XFxjb2ZyZWVfcCBcXG90aW1lcyBbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfcV19Il0sWzIsMywiXFxjb2ZyZWVfe1xcZXZhbH0iXSxbMyw0LCJcXGNjb3VuX3tcXGNvZnJlZV9xfSJdLFsxLDIsIlxcbGF4Il0sWzEsNSwiXFxjY291bl97XFxjb2ZyZWVfcH0gXFxvdGltZXMgXFxjY291bl97W1xcY29mcmVlX3AsIFxcY29mcmVlX3FdfSIsMV0sWzAsNSwiXFxjb2ZyZWVfcCBcXG90aW1lcyBcXGNjb3VuX3tbXFxjb2ZyZWVfcCwgXFxjb2ZyZWVfcV19IiwyXSxbMCwxLCJcXGN1bl97XFxjb2ZyZWVfcH0gXFxvdGltZXMgXFxjb2ZyZWVfe1tcXGNvZnJlZV9wLCBcXGNvZnJlZV9xXX0iXV0=
\[\begin{tikzcd}[sep=huge]
	{\cofree_p \otimes \cofree_{[\cofree_p, \cofree_q]}} & {\cofree_{\cofree_p}\otimes \cofree_{[\cofree_p, \cofree_q]}} & {\cofree_{\cofree_p \otimes [\cofree_p, \cofree_q]} } & {\cofree_{\cofree_q}} \\
	&& {\cofree_p \otimes [\cofree_p, \cofree_q]} & {\cofree_q}
	\arrow["{\cun_{\cofree_p} \otimes \cofree_{[\cofree_p, \cofree_q]}}", from=1-1, to=1-2]
	\arrow["{\cofree_p \otimes \ccoun_{[\cofree_p, \cofree_q]}}"', bend right=15pt, from=1-1, to=2-3]
	\arrow["\lax", from=1-2, to=1-3]
	\arrow["{\ccoun_{\cofree_p} \otimes \ccoun_{[\cofree_p, \cofree_q]}}"{description}, from=1-2, to=2-3]
	\arrow["{\cofree_{\eval}}", from=1-3, to=1-4]
	\arrow["{\ccoun_{\cofree_p \otimes [\cofree_p, \cofree_q]}}", from=1-3, to=2-3]
	\arrow["{\ccoun_{\cofree_q}}", from=1-4, to=2-4]
	\arrow["\eval"', from=2-3, to=2-4]
\end{tikzcd}\]

  The left-hand triangle commutes by the zig-zag law of the adjunction. The middle triangle commutes by definition of the compositor. And the right-hand square commutes by naturality of the co-unit.

  These maps satisfy the counit law because of the zig-zag laws of the adjunction. Co-multiplication satisfies co-associativity by naturality of the unit. 

    
\end{proof}

\begin{remark}
    As in \cref{rmk:free-lifts} the comonad $U \circ \cofree \colon \poly \to \poly$ is the image of $\smcat^\sharp$-enriched comonad $\cofree \colon \org^\sharp \to \org^\sharp$ under the map of the enriching functors $\smcat^\sharp(\yon, -) \colon \smcat^\sharp \to \smset$.
\end{remark}

\section{The operad $(\org^\sharp)^\cofree$}

As in \cref{sec:operad-orgm}, we will define a $\smcat^\sharp$-enriched operad $(\org^\sharp)^\cofree$ whose 1-ary morphisms are the morphisms of the co-Kleisli category $(\org^\sharp)^\cofree$. However, unlike the operad $\org^\sharp_\free$, this operad will not underlie a symmetric monoidal structure on the co-Kleisli category. We choose this more bespoke definition, because it leads to a lovely correspondence with the $\smcat^\sharp$-enriched operad $\org^\sharp_\free$ that is at the heart of \cref{sec:matter-pattern}.

\begin{theorem}
    There is a $\smcat^\sharp$-enriched operad $(\org^\sharp)^\cofree$ whose objects are polynomials and whose morphisms are defined by 
    \[
        (\org^\sharp)^\cofree(p_1, \cdots , p_m; q) \coloneqq \cofree_{[\cofree_{p_1} \otimes \cdots \otimes \cofree_{p_m}, q]}.
    \]
\end{theorem}
\begin{proof}
    For a polynomial $p$, the identity on $p$ is given by the image of the counit $\ccoun_p \colon \cofree_p \to p$ under the isomorphisms
    \[
        \poly(\cofree_p, p) \iso \poly(\yon, [\cofree_p, p]) \iso \smcat^\sharp(\yon, \cofree_{[\cofree_p, p]}).
    \]
    Composition $\circ_i$ is given by the image of the polynomial map
    \begin{align*}
        &\left(\bigotimes_{i = 1, i \neq k}^n \cofree_{q_i} \right) \otimes \left(\bigotimes_{i = 1}^m \cofree_{p_i}\right) \otimes \cofree_{[\cofree_{p_1} \otimes \cdots \otimes \cofree_{p_m}, q_k]} \otimes \cofree_{[\cofree_{q_1} \otimes \cdots \otimes \cofree_{q_n}, r]}\\
        &\xrightarrow{\cun_{\cofree_{p_i}}} \left(\bigotimes_{i = 1, i \neq k}^n \cofree_{q_i} \right) \otimes \left(\bigotimes_{i = 1}^m \cofree_{\cofree_{p_i}}\right) \otimes \cofree_{[\cofree_{p_1} \otimes \cdots \otimes \cofree_{p_m}, q_k]} \otimes \cofree_{[\cofree_{q_1} \otimes \cdots \otimes \cofree_{q_n}, r]}\\
        &\xrightarrow{\lax} \left(\bigotimes_{i = 1}^n \cofree_{q_i} \right)  \otimes \cofree_{[\cofree_{q_1} \otimes \cdots \otimes \cofree_{q_n}, r]}\\
        &\xrightarrow{\cun_{\cofree_{q_i}}}  \left(\bigotimes_{i = 1}^n \cofree_{\cofree_{q_i}} \right)  \otimes \cofree_{[\cofree_{q_1} \otimes \cdots \otimes \cofree_{q_n}, r]}\\
        &\xrightarrow{\lax} \cofree_r\\
        & \xrightarrow{\ccoun_r}  r.
    \end{align*}
    in
    \[
        \smcat^\sharp(\cofree_{[\cofree_{p_1} \otimes \cdots \otimes \cofree_{p_m}, q_k]} \otimes \cofree_{[\cofree_{q_1} \otimes \cdots \otimes \cofree_{q_n}, r]}, \cofree_{[\cofree_{q_1} \otimes \cdots \otimes \cofree_{q_{k - 1}} \otimes \cofree_{p_1} \otimes \cdots \otimes \cofree_{p_m} \otimes \cofree_{q _{k + 1}} \otimes \cdots \otimes \cofree_{q_n}, r]})
    \]
    The unit and associativity laws follow from parallel reasoning of the unit and associativity laws of the comonad $\cofree \colon \org^\sharp \to \org^\sharp$.
\end{proof}

\begin{definition}
    Let $\org^\cofree$ be the $\smcat$-enriched category corresponding to $(\org^\sharp)^\cofree$ under the map of enriching categories $\smset^- \colon \smcat^\sharp \to \smcat$.
\end{definition}

\begin{example}
    A coalgebra in $\org^\cofree(A_1\yon, \cdots , A_n\yon; B\yon)$ on positions takes a state and a stream of symbols in $A_i$ for each $i = 1, \cdots, n$ and produces a symbol in $B$. On directions, it updates the state and returns a prefix in each of the $A_i$ streams. As we will see in \cref{sec:matter-pattern}, we interpret these prefixes as the symbols in each $A_i$ which were used in the production of the $B$ symbol. Furthermore, we interpret the $A_i$ streams as behaviors of subordinates. These subordinates simply output a symbol in $A_i$ when they are invoked, and each subordinate may be invoked any finite number of times in order to produce a symbol in $B$.
\end{example}